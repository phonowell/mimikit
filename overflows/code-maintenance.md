# 工作流：代码维护（src/.ts/.js）

## 目的
- 约束 ./src 下 .ts/.js 行数到 30–200
- 让模块/组件/功能隔离，降低耦合
- 删除冗余、重复、不需要的代码

## 范围与约束
- 仅处理 ./src/**/*.ts 与 ./src/**/*.js
- ESM + 严格类型，避免 any
- 文件行数 30–200；超出需拆分，不足需合并

## 入口命令
- 统计行数
```
rg --files -0 -g 'src/**/*.ts' -g 'src/**/*.js' | xargs -0 wc -l | sort -n
```
- 标记超限/不足
```
rg --files -0 -g 'src/**/*.ts' -g 'src/**/*.js' | xargs -0 wc -l | awk '$1 < 30 || $1 > 200'
```

## 步骤
1. 生成行数清单，标记 <30 与 >200
2. 逐个处理：先拆分 >200，再合并 <30
3. 复核隔离性与依赖边界
4. 删除/合并冗余与重复实现
5. 运行验证命令并记录结果

## 拆分规则（>200）
- 按单一职责拆：视图/状态/数据访问/工具分离
- 共享逻辑下沉到 ./src 下同域目录，避免跨域 import
- 保留稳定入口，必要时新增 barrel 文件

## 合并规则（<30）
- 与最近的同域模块合并，保持职责连续
- 避免为凑行数引入跨域依赖
- 合并后重新校验 30–200

## 隔离检查
- 依赖只从上层到下层，禁止反向引用
- 模块之间通过显式接口交互，不共享隐式状态
- 避免循环依赖与跨域工具滥用

## 去冗余清单
- 删除未使用导出、重复工具函数、重复样式/常量
- 合并功能重叠的模块，保留单一来源
- 删除死代码路径与过期分支

## 验证
- lint
```
pnpm lint
```
- type-check
```
pnpm exec tsc -p tsconfig.json --noEmit
```
- test
```
pnpm test
```

## 结果记录
- 变更范围、合并/拆分理由、删除清单、验证结果
